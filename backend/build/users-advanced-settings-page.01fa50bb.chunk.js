"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[9460],{98352:(de,S,n)=>{n.r(S),n.d(S,{default:()=>ie});var a=n(67294),y=n(23724),z=n(97132),D=n(80831),l=n(68547),I=n(14087),b=n(185),M=n(67838),P=n(49066),G=n(29728),Z=n(35961),H=n(7681),j=n(91216),W=n(82562),Q=n(72735),U=n(11276),B=n(74571),K=n(85018),A=n(81912),t=n(89031);const V=[{intlLabel:{id:(0,t.OB)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,t.OB)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,t.OB)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,t.OB)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,t.OB)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,t.OB)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,t.OB)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,t.OB)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,t.OB)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,t.OB)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,t.OB)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,t.OB)("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var f=n(63600);const F=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),X=f.Ry().shape({email_confirmation_redirection:f.nK().when("email_confirmation",{is:!0,then:f.Z_().matches(F).required(),otherwise:f.Z_().nullable()}),email_reset_password:f.Z_(l.translatedErrors.string).matches(F,l.translatedErrors.regex).nullable()});var $=(e,s,i)=>new Promise((g,u)=>{var p=o=>{try{d(i.next(o))}catch(c){u(c)}},v=o=>{try{d(i.throw(o))}catch(c){u(c)}},d=o=>o.done?g(o.value):Promise.resolve(o.value).then(p,v);d((i=i.apply(e,s)).next())});const J=()=>$(void 0,null,function*(){const{data:e}=yield t.be.get((0,t.Gc)("advanced"));return e}),Y=e=>t.be.put((0,t.Gc)("advanced"),e);var k=Object.defineProperty,q=Object.defineProperties,_=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable,L=(e,s,i)=>s in e?k(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,E=(e,s)=>{for(var i in s||(s={}))ee.call(s,i)&&L(e,i,s[i]);if(T)for(var i of T(s))te.call(s,i)&&L(e,i,s[i]);return e},w=(e,s)=>q(e,_(s)),x=(e,s,i)=>new Promise((g,u)=>{var p=o=>{try{d(i.next(o))}catch(c){u(c)}},v=o=>{try{d(i.throw(o))}catch(c){u(c)}},d=o=>o.done?g(o.value):Promise.resolve(o.value).then(p,v);d((i=i.apply(e,s)).next())});const ae=()=>a.createElement(l.CheckPagePermissions,{permissions:A.Z.readAdvancedSettings},a.createElement(ne,null)),ne=()=>{const{formatMessage:e}=(0,z.useIntl)(),s=(0,l.useNotification)(),{lockApp:i,unlockApp:g}=(0,l.useOverlayBlocker)(),{notifyStatus:u}=(0,I.G)(),p=(0,y.useQueryClient)();(0,l.useFocusWhenNavigate)();const v=(0,a.useMemo)(()=>({update:A.Z.updateAdvancedSettings}),[]),{isLoading:d,allowedActions:{canUpdate:o}}=(0,l.useRBAC)(v),{status:c,data:C}=(0,y.useQuery)("advanced",()=>J(),{onSuccess(){u(e({id:(0,t.OB)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError(){s({type:"warning",message:{id:(0,t.OB)("notification.error"),defaultMessage:"An error occured"}})}}),se=d||c!=="success",N=(0,y.useMutation)(m=>Y(m),{onSuccess(){return x(this,null,function*(){yield p.invalidateQueries("advanced"),s({type:"success",message:{id:(0,t.OB)("notification.success.saved"),defaultMessage:"Saved"}}),g()})},onError(){s({type:"warning",message:{id:(0,t.OB)("notification.error"),defaultMessage:"An error occured"}}),g()},refetchActive:!0}),{isLoading:oe}=N,re=m=>x(void 0,null,function*(){i();const h=m.email_confirmation?m.email_confirmation_redirection:"";yield N.mutateAsync(w(E({},m),{email_confirmation_redirection:h}))});return se?a.createElement(b.o,{"aria-busy":"true"},a.createElement(l.SettingsPageTitle,{name:e({id:(0,t.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),a.createElement(M.T,{title:e({id:(0,t.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),a.createElement(P.D,null,a.createElement(l.LoadingIndicatorPage,null))):a.createElement(b.o,{"aria-busy":oe},a.createElement(l.SettingsPageTitle,{name:e({id:(0,t.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),a.createElement(D.Formik,{onSubmit:re,initialValues:C.settings,validateOnChange:!1,validationSchema:X,enableReinitialize:!0},({errors:m,values:h,handleChange:R,isSubmitting:le})=>a.createElement(l.Form,null,a.createElement(M.T,{title:e({id:(0,t.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:a.createElement(G.z,{loading:le,type:"submit",disabled:!o,startIcon:a.createElement(K.Z,null),size:"S"},e({id:"global.save",defaultMessage:"Save"}))}),a.createElement(P.D,null,a.createElement(Z.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},a.createElement(H.K,{spacing:4},a.createElement(Q.Z,{variant:"delta",as:"h2"},e({id:"global.settings",defaultMessage:"Settings"})),a.createElement(U.r,{gap:6},a.createElement(B.P,{col:6,s:12},a.createElement(j.P,{label:e({id:(0,t.OB)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:h.default_role,hint:e({id:(0,t.OB)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:r=>R({target:{name:"default_role",value:r}})},C.roles.map(r=>a.createElement(W.W,{key:r.type,value:r.type},r.name)))),V.map(r=>{let O=h[r.name];return O||(O=r.type==="bool"?!1:""),a.createElement(B.P,E({key:r.name},r.size),a.createElement(l.GenericInput,w(E({},r),{value:O,error:m[r.name],disabled:r.name==="email_confirmation_redirection"&&h.email_confirmation===!1,onChange:R})))}))))))))},ie=ae}}]);
